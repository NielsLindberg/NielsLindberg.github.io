<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Copenhagen Map">
    <meta name="author" content="Niels Lindberg-Poulsen">
    <title>Neighborhood Map</title>
    <link href="css/style.css" rel="stylesheet">
    <script src="../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../bower_components/knockout/dist/knockout.js"></script>
    <script src="../bower_components/oauth-signature/dist/oauth-signature.min.js"></script>
</head>

<body>
    <script>
    function nonce_generate() {
        return (Math.floor(Math.random() * 1e12).toString());
    }

    var YELP_BASE_URL = 'https://api.yelp.com/v2/';
    var YELP_KEY = '_xLjE_NxysOGBW9vTF4YAA';
    var YELP_TOKEN = 'foyoWs_yChb81DQX4JivNt8b-ka_hVr9';
    var YELP_KEY_SECRET = 'rR7blQEyj5FSjmtupIgScck7D58';
    var YELP_TOKEN_SECRET = 'MkQHBL_fc2r4nIOrcLXemdffK2Y';

    var lat = 55.6677494;
    var lng = 12.548833000000059;
    var businessID = 'scarpetta-k√∏benhavn-n';
    var businessIDencoded = encodeURI(businessID);
    var yelp_url = YELP_BASE_URL + 'business/' + businessIDencoded;
    var parameters = {
        oauth_consumer_key: YELP_KEY,
        oauth_token: YELP_TOKEN,
        oauth_nonce: nonce_generate(),
        oauth_timestamp: Math.floor(Date.now() / 1000),
        oauth_signature_method: 'HMAC-SHA1',
        oauth_version: '1.0',
        callback: 'cb'
        //term: 'food',
        //ll: lat + ',' +lng
    };

    var encodedSignature = oauthSignature.generate('GET', yelp_url, parameters, YELP_KEY_SECRET, YELP_TOKEN_SECRET);
    parameters.oauth_signature = encodedSignature;

    var settings = {
        url: yelp_url,
        data: parameters,
        cache: true, // This is crucial to include as well to prevent jQuery from adding on a cache-buster parameter "_=23489489749837", invalidating our oauth-signature
        dataType: 'jsonp',
        success: function(results) {
            // Do stuff with results
            console.log(results);
        },
        fail: function(results) {
            // Do stuff on fail
            console.log(results);
        }
    };

    // Send AJAX query via jQuery library.
    $.ajax(settings);
    </script>
    <header>
    </header>
    <div class="page-wrapper">
        <main class="content">
            <div class="left-menu">
                <select data-bind="options: uniqueCategories, value: categoriesFilter"></select>
                <div class="list-container">
                    <ul data-bind="foreach: entryListFiltered">
                        <div class="list-item">
                            <p class="title-label" data-bind="text: title, click: vm.itemLabelFilter"></p>
                            <p class="category-label" data-bind="text: category, click: vm.categoryLabelFilter"></p>
                            <p class="item-id" data-bind="text: id, style: { backgroundColor: vm.categoryColors[category] }"></p>
                        </div>
                    </ul>
                    </hr>
                </div>
                <div id="result-container" class="result-container">
                    <input id="show-panorama" class="content-button" type="button" value="Show Panorama">
                    <div id="pano" class="content-container"></div>
                    <input id="show-directions" class="content-button" type="button" value="Show Directions">
                    <div id="directions" class="content-container"></div>
                    <input id="show-facebook" class="content-button" type="button" value="Show Facebook">
                    <div id="facebook" class="content-container"></div>
                </div>
            </div>
            <div id="map"></div>
        </main>
        <footer>
        </footer>
    </div>
</body>
<script src="js/models/mapEntries.js"></script>
<script src="js/mapStyles.js"></script>
<script src="js/main.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDwCMeEpZWGWPIgmzaGxGj7D4odnXZQVkE&v=3&callback=vm.initMap&libraries=places,geometry,drawing"></script>

</html>
